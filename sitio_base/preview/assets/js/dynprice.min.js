!function($){$.dynprice=function(options){var dynprice=this,options=options||{},COUNTRY_SETTINGS={facl:{urlDebug:"",url:"http://www.falabella.com/falabella-cl/browse/productJson.jsp?productId=",thousandSeparator:".",decimalSeparator:",",currency:"$",scene7url:"http://falabella.scene7.com/is/image/Falabella/",productURL:"http://www.falabella.com/falabella-cl/product/"},faco:{urlDebug:"http://utilsfalabella.appspot.com/apis/productList/?apikey=a02506b31c1cd46c2e0b6380fb94eb3d&productId=",url:"http://www.falabella.com.co/falabella-co/browse/productJson.jsp?productId=",thousandSeparator:".",decimalSeparator:",",currency:"$",scene7url:"http://falabella.scene7.com/is/image/FalabellaCO/",productURL:"http://www.falabella.com.co/falabella-co/product/"},fape:{urlDebug:"http://utilsfalabella.appspot.com/apis/productList/?apikey=a02506b31c1cd46c2e0b6380fb94eb3d&productId=",url:"http://www.falabella.com.co/falabella-co/browse/productJson.jsp?productId=",thousandSeparator:",",decimalSeparator:".",currency:"S/. ",scene7url:"http://falabella.scene7.com/is/image/FalabellaPE/",productURL:"http://www.falabella.com.pe/falabella-pe/product/"}};dynprice.init=function(){options.debug&&console.log("Dynprice info: Dynprice iniciando V4");var o=dynprice.findElements();o?(options.debug&&console.log("Dynprice info: "+o.length+" elementos encontrados"),dynprice.fillImages(o),$.when(dynprice.getInfoFromJSON(dynprice.getSKUsFromDynpriceElements(o))).done(function(n){dynprice.fillInfo(o,n),options.dynpriceHide&&$(".dynprice-hide").remove(),options.addCurrency&&dynprice.addCurrency(o)})):options.debug&&console.log("Dynprice error: No existen dynprice-products en el documento")},dynprice.findElements=function(){var o=$("[dynprice-product]");if(o.length>0){for(var n=0;n<o.length;n++){var e=o.eq(n);if(!e.attr("dynprice-product"))return options.debug&&(console.log("Dynprice error: Existe un dynprice-product sin SKU asignado."),console.log(e)),[]}return o}return[]},dynprice.getSKUsFromDynpriceElements=function(o){for(var n="",e=0;e<o.length;e++)n+=e===o.length-1?o.eq(e).attr("dynprice-product"):o.eq(e).attr("dynprice-product")+"-";return options.debug&&console.log("Dynprice info: skus a imprimir "+n),n},dynprice.fillImages=function(o){var n=o.find("[dynprice-image]");return n.length>0&&o.each(function(){var o=$(this).attr("dynprice-product");$(this).find("[dynprice-image]").attr("src",COUNTRY_SETTINGS[options.country].scene7url+o)}),o.find("[dynprice-image]")},dynprice.getInfoFromJSON=function(o){if(options.debug&&COUNTRY_SETTINGS[options.country].urlDebug)var n=COUNTRY_SETTINGS[options.country].urlDebug;else var n=COUNTRY_SETTINGS[options.country].url;return $.ajax({url:n+o,dataType:"json"})},dynprice.formatPrice=function(o){if(options.debug&&console.log("Dynprice info: formateando precio "+o),"."===COUNTRY_SETTINGS[options.country].thousandSeparator){var n=o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");return options.debug&&console.log("Dynprice info: precio formateado "+n),n}if(","===COUNTRY_SETTINGS[options.country].thousandSeparator){var n=o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");return options.debug&&console.log("Dynprice info: precio formateado "+n),n}},dynprice.addCurrency=function(o){o.find(".dynprice-price").prepend('<span class="dynprice-currency">'+COUNTRY_SETTINGS[options.country].currency+"</span>")},dynprice.createURL=function(o){return COUNTRY_SETTINGS[options.country].productURL+o+"/"},dynprice.fillInfo=function($dynpriceProducts,jsonInfo){for(var i=0;i<$dynpriceProducts.length;i++){var $dynpriceProduct=$dynpriceProducts.eq(i),sku=$dynpriceProduct.attr("dynprice-product");options.debug&&console.log("Dynprice info: Llenando informaciÃ³n del SKU "+sku);for(var j=0;j<jsonInfo.length;j++)if(jsonInfo[j].productId===sku){options.dynpriceInfo&&$dynpriceProduct.attr("dynprice-json-info",JSON.stringify(jsonInfo[j])),options.debug&&console.log("Dynprice info: Buscando si el sku esta publicado"),"Not OK"===jsonInfo[j].status||jsonInfo[j].published!==!0?(options.debug&&console.log("Dynprice info: No se puede mostrar el producto "+jsonInfo[j].productId+". Se aplica la clase dynprice-hide."),$dynpriceProduct.addClass("dynprice-hide")):options.debug&&console.log("Dynprice info: el producto esta publicado"),options.debug&&console.log("Dynprice info: Buscando precio CMR"),jsonInfo[j].CMR?(options.debug&&console.log("Dynprice info: Precio CMR encontrado"),$dynpriceProduct.find("[dynprice-price1]").html(dynprice.formatPrice(jsonInfo[j].CMR)).addClass("dynprice-main-price CMR dynprice-price")):(options.debug&&console.log("Dynprice info: No hay precio CMR"),$dynpriceProduct.find("[dynprice-price1]").addClass("dynprice-hide")),options.debug&&console.log("Dynprice info: Buscando precio Internet"),jsonInfo[j].INTERNET&&jsonInfo[j].NORMAL!==jsonInfo[j].INTERNET?(options.debug&&console.log("Dynprice info: precio Internet encontrado"),$dynpriceProduct.find("[dynprice-price2]").html(dynprice.formatPrice(jsonInfo[j].INTERNET)).addClass("precio-internet dynprice-price"),jsonInfo[j].CMR||$dynpriceProduct.find("[dynprice-price2]").addClass("dynprice-main-price")):(options.debug&&console.log("Dynprice info: precio Internet no encontrado"),$dynpriceProduct.find("[dynprice-price2]").addClass("dynprice-hide")),options.debug&&console.log("Dynprice info: Buscando precio Normal"),jsonInfo[j].NORMAL?(options.debug&&console.log("Dynprice info: Precio Normal encontrado"),$dynpriceProduct.find("[dynprice-price3]").html(dynprice.formatPrice(jsonInfo[j].NORMAL)).addClass("precio-normal dynprice-price"),jsonInfo[j].CMR||jsonInfo[j].NORMAL!==jsonInfo[j].INTERNET||$dynpriceProduct.find("[dynprice-price3]").addClass("dynprice-main-price")):(options.debug&&console.log("Dynprice info: precio Normal no encontrado"),$dynpriceProduct.find("[dynprice-price3]").addClass("dynprice-hide")),options.debug&&console.log("Dynprice info: Agregando Marca"),jsonInfo[j].brand&&$dynpriceProduct.find("[dynprice-brand]").html(jsonInfo[j].brand).addClass("dynprice-marca"),options.debug&&console.log("Dynprice info: Agregando Descripcion"),jsonInfo[j].name&&$dynpriceProduct.find("[dynprice-name]").html(jsonInfo[j].name).addClass("dynprice-descripcion"),options.debug&&console.log("Dynprice info: Agregando ahorro");var ahorro=0;jsonInfo[j].CMR?ahorro=eval(jsonInfo[j].NORMAL)-eval(jsonInfo[j].CMR):jsonInfo[j].INTERNET&&(ahorro=eval(jsonInfo[j].NORMAL)-eval(jsonInfo[j].INTERNET)),ahorro?$dynpriceProduct.find("[dynprice-ahorro]").html(dynprice.formatPrice(ahorro)).addClass("dynprice-ahorro dynprice-price"):$dynpriceProduct.find("[dynprice-ahorro]").addClass("dynprice-hide"),options.debug&&console.log("Dynprice info: Agregando descuento");var discount=0;if(jsonInfo[j].CMR){var precioNormal=eval(jsonInfo[j].NORMAL),precioCMR=eval(jsonInfo[j].CMR);discount=100*(precioNormal-precioCMR)/precioNormal}else if(jsonInfo[j].INTERNET){var precioNormal=eval(jsonInfo[j].NORMAL),precioOferta=eval(jsonInfo[j].INTERNET);discount=100*(precioNormal-precioOferta)/precioNormal}$dynpriceProduct.find("[dynprice-discount]").html(discount.toFixed()).addClass("dynprice-discount"),options.debug&&console.log("Dynprice info: Agregando url"),$dynpriceProduct.find("[dynprice-href]").attr("href",dynprice.createURL(jsonInfo[j].productId)).addClass("dynprice-url")}}},dynprice.init()}}(jQuery);